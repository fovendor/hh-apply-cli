# hhcli

Консольная интерактивная утилита для удобного поиска вакансий и откликов на hh.ru. Программа использует [hh-applicant-tool](https://github.com/s3rgeym/hh-applicant-tool) в качестве бэкенда для взаимодействия с API.

![gif of hh-cli](img/review.gif "A short demo CLI TUI interface").

## Ключевые возможности

* **Два режима поиска:** Автоматический (на основе рекомендаций hh.ru для вашего резюме) и ручной (гибкий поиск по ключевым словам, городу, формату работы и другим критериям).
* **Интерактивный интерфейс:** Удобный TUI-интерфейс на базе `fzf` для просмотра, фильтрации и выбора вакансий.
* **Предпросмотр без браузера:** Встроенный просмотр полного описания вакансии, включая требуемые навыки и контакты.
* **Множественная отправка откликов:** Выберите десятки вакансий и откликнитесь на все одной командой.
* **Умная защита от дублей:** Скрипт проверяет полную историю ваших откликов и позволяет (при желании) не отправлять отклик в компанию, куда уже откликались ранее.
* **Локальные отчеты:** Все ваши действия по откликам сохраняются в локальные CSV-файлы для последующего анализа.
* **Темы оформления:** Настройте оформление утилиты под ваши предпочтения через переменные в конфиге.

## Установка и обновление

Установка производится одной командой в терминале. Инсталлятор автоматически проверит зависимости, установит нужные компоненты, создаст файл конфигурации и нужные для работы программы системные каталоги.

```bash
bash <(curl -sSL -H "Cache-Control: no-cache" https://raw.githubusercontent.com/fovendor/hhcli/master/install.sh) install
```

## Удаление

Для полного удаления программы, ее конфигурационных файлов, кэша и бэкенда выполните команду:

```bash
bash <(curl -sSL https://raw.githubusercontent.com/fovendor/hhcli/master/install.sh) uninstall
```

## Первый запуск и настройка

После установки необходимо выполнить три простых шага:

#### 1. Авторизация

Запустите команду аутентификации. Она откроет браузер для входа в ваш аккаунт на hh.ru.

```bash
hhcli --auth
```

#### 2. Настройка поиска

При установке создаётся файл конфигурации. Откройте его в текстовом редакторе и настройте параметры ручного поиска (ключевые слова, исключения, проф. роли и т.д.).

```bash
nano ~/.config/hhcli/config.sh
```

#### 3. Запуск

После настройки конфига вы готовы к поиску. Запустите главный скрипт и следуйте интерактивным подсказкам:

```bash
hhcli
```

## Использование

Вот основные команды для работы с `hhcli`:

| Команда | Описание |
| :--- | :--- |
| `hhcli -h` | Помощь по основным командам. |
| `hhcli -p` | Показывает справочник профессиональных ролей (чтобы выйти из списка ролей нажмите `q`) |
| `hhcli` | Запускает основной интерактивный режим поиска. |
| `hhcli --auth` | Выполняет аутентификацию или обновляет токен доступа. |
| `hhcli --list-resumes` | Показывает список ваших резюме и их ID. |
| `hhcli --find-city` | Помогает найти ID города для файла конфигурации. |
| `hhcli --clear-cache` | Удаляет локальный кэш (города, словари и т.д.). |
| `hhcli proxy [cmd]`	| Передает команду [cmd] напрямую бэкенду. Чтобы узнать подробнее выполните: `hh-applicant-tool -h`. |

## Обработка ошибок API и ограничений платформы

Скрипт умеет обрабатывать криворукость разработчиков некоторые странности в ответах API hh.ru:

- Пустое описание: Выводится заглушка [ Описание ... недоступно через API ].
- "Битые" JSON: Скрипт удалит поврежденный файл из кэша и предложит просмотреть вакансию еще раз.
- Вакансии с вопросами: Отклики на вакансии, требующие ответов на вопросы, будут автоматически пропущены, но появятся в итоговом CSV-отчете, чтобы вы могли откликнуться на них вручную.

## TODO

Изначально hhcli не планировался как большой и долго поддерживаемый проект. Но текущая ситуация на рынке труда: глупые алгоритмы отбора, фейковые вакансии, некомпетентные HR'ы и в целом низкая эффективность ручного поиска мотивируют меня развивать этот инструмент дальше. 

Чтобы иметь возможность это делать, нужно будет "выйти и зайти нормально". Становится трудно поддерживать Bash-код и огромные регулярные выражения, думаю про перенос всей кодовой базы на Python. К тому же я упёрся в потолок костылей с `w3m` и `fzf` в плане UX.

План примерно такой:

### Рефакторинг

1. Написать собственный цикл аутентификации через OAuth2 без `hh-applicant-tool`. Уже получены официальные `Client Id` и `Client Secret` от официального API hh.ru. Нужно будет поднять веб-сервер для колбэка, обработать токены, сделать логику refresh_token.
2. Сделать собственный API-клиент и отказаться от проксирования вызовов через `hh-applicant-tool`. Написать с нуля все эндпоинты:

   - `/resumes/mine` (получение резюме)
   - `/vacancies` (поиск вакансий)
   - `/resumes/{resume_id}/similar_vacancies` (рекомендованные вакансии)
   - `/negotiations` (история откликов)
   - POST `/negotiations` (отправка отклика)
   - `/dictionaries, /areas` (справочники)

#### ФТ

1. Сделать поддержку нескольких профилей поиска (`hhcli --profile <name>`). Сейчас приходится костылить и хранить в комментах конфига пути к разным сопроводительным письмам, разные параметры поиска и т.д. 
2. Обезопасить конфиг через интерактивную настройку (`hhcli --configure`). Сам часто получаю ошибки при запуске, когда редактирую конфиг в `nano` и стираю какую-нибудь скобку не в том месте.

#### НФТ

1. Отказаться от кэша в `.json` и отчётов в `.csv` в пользу единой базы данных **SQLite**. Там хранить всё: историю откликов, кэш откликов, кэш описания вакансий и вот это всё. Получаем защиту от кривого сохранения файлов, отсутствие надобности парсить строки, чтобы вытягивать аналитику, да и вообще это удобно. Конфиги хранить там же и переключать их флагом `--profile <name>` (решение [проблемы №8](https://github.com/fovendor/hhcli/issues/8)).
2. Заменить `fzf` + `w3m` на нативный TUI (думаю про [Textual](https://github.com/textualize/textual/)).
3. Сделать кроссплатформенную установку на разные оси (Linux, macOS, Windows).

## Оговорка

Вся работа с API делегирована утилите hh-applicant-tool. Если в ней произойдут критические изменения или она перестанет работать из-за изменений на стороне hh.ru, этот скрипт также перестанет работать.

## Лицензия

[MIT](https://choosealicense.com/licenses/mit/)

## Благодарности

- Огромная благодарность **Сергею ([s3rgeym](https://github.com/s3rgeym))** за создание и поддержку [hh-applicant-tool](https://github.com/s3rgeym/hh-applicant-tool).
