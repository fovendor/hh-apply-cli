# hh-apply-cli

hh-apply-cli — это CLI-инструмент для интерактивного поиска вакансий на HeadHunter, позволяющий быстро фильтровать, просматривать и массово откликаться на выбранные вакансии из терминала. Скрипт использует утилиту [hh-applicant-tool](https://github.com/s3rgeym/hh-applicant-tool) для взаимодействия с API hh.ru и оборачивает её в TUI-интерфейс на базе `fzf`.

![gif of hh-cli](img/review.gif "A short demo CLI TUI interface").

## Оглавление

- [Основная идея](#основная-идея)
- [Ключевые возможности](#ключевые-возможности)
- [Установка](#установка)
  - [Шаг 1: Установка hh-applicant-tool](#шаг-1-установка-hh-applicant-tool)
  - [Шаг 2: Установка hh-apply-cli и зависимостей](#шаг-2-установка-hh-apply-cli-и-зависимостей)
- [Принцип работы](#принцип-работы)
  - [Интерактивный визард](#интерактивный-визард)
  - [Настройки для ручного режима](#настройки-для-ручного-режима)
  - [Общие настройки](#общие-настройки)
  - [Настройка таблицы и цветов](#настройка-таблицы-и-цветов)
- [Продвинутое использование](#продвинутое-использование)
  - [Кэширование для защиты от блокировок](#кэширование-для-защиты-от-блокировок)
  - [Обработка ошибок API и ограничений платформы](#обработка-ошибок-api-и-ограничений-платформы)
- [Оговорка](#оговорка)
- [Лицензия](#лицензия)
- [Благодарности](#благодарности)

## Основная идея

С конца 2024 года поиск работы стал крайне трудным и рутинным процессом. Ещё сильнее дело осложняется роботами, кривыми MCP-серверами с LLM, которые как-то (на самом деле ХЗ, как именно, у каждой компании свои причуды) отсеивают отклики и отвечают отказом или игнором. Часто встречаются вакансии, набирающие по 3000+ откликов за сутки. Часто встречаются фейковые вакансии (особенно с большим количеством входных вопросов, анкет), так компании собирают описание и стек кандидатов для статистики и формирования идеального образа кандидатов.

В таких условиях просиживание на hh.ru, применение одних и тех же фильтров, просмотр сотен вакансий, отслеживание подходящих и запоминание, куда уже был отправлен отклик — очень неприятный и длительный процесс. Скрипт `hh-apply-cli` автоматизирует большую часть этой рутины. Без рекламы и СМС, инфошума, медленной загрузки ~~крайне уродского~~ фронтенда и лишних сотен кликов. Вся информация — в вашем терминале.

## Ключевые возможности

- **Интерактивный визард:** При запуске скрипт проведет вас через все шаги: выбор резюме, режима поиска и настройку фильтров (формат работы, город, зарплата).
- **Два режима поиска:**
    - **Автоматический (рекомендуемый):** Использует официальный API hh.ru для получения **рекомендованных вакансий**, подобранных внутренними алгоритмами под ваше резюме. Затем к этому списку применяются выбранные вами фильтры.
    - **Ручной:** Работает по классической схеме с фильтрацией по ключевым словам (`TEXT_INCLUDE`, `NEGATIVE`), проф. ролям и другим параметрам, заданным в файле скрипта.
- **Расширенный предпросмотр:** При выборе вакансии справа выводится её полное описание, город, ключевые навыки и контакты (если они доступны).
- **Защита от повторных откликов:** Скрипт определяет и помечает компании, на вакансии которых вы уже откликались.
- **Дедупликация:** Автоматическое удаление дублей вакансий по паре "Название + Компания".
- **Массовые отклики:** Возможность выбрать несколько вакансий (клавишей `Tab`) и откликнуться на все одним нажатием `Enter`.
- **Поддержка сопроводительных писем:** Используется письмо по умолчанию из конфига `hh-applicant-tool` или из кастомного файла.
- **Безопасность:** Перед отправкой откликов требуется ввести случайно сгенерированный код для защиты от случайных действий.
- **"Умное" кэширование:** Детальные описания вакансий, а также справочники API (города, графики работы) кэшируются для ускорения работы и снижения числа запросов к hh.ru.
- **Отчетность:** Каждый сеанс откликов сохраняется в CSV-отчёте.

## Установка

### Шаг 1: Установка `hh-applicant-tool`

```bash
# Клонируем репозиторий
git clone https://github.com/s3rgeym/hh-applicant-tool.git
cd hh-applicant-tool

# Создаем и активируем виртуальную среду
python3 -m venv venv
source venv/bin/activate

# Устанавливаем саму утилиту и ее QT-зависимости для авторизации
pip install .
pip install 'hh-applicant-tool[qt]'

# Проверяем, что утилита работает
hh-applicant-tool -h

# Проходим процедуру аутентификации (откроется окно QT-браузера)
hh-applicant-tool authorize

# Проверяем, что аутентификация удалась
hh-applicant-tool whoami
```

**Конфиг с сопроводительным письмом:**

Чтобы узнать, где находится конфиг, выполните:

```bash
hh-applicant-tool config -p
```

Откройте любым текстовым редактором и вставьте ваш вариант сопроводительного письма. Например:

```json
{
  "reply_message": "Здравствуйте!\n\nПонравилось описание вакансии, хотелось бы подробнее узнать о ваших требованиях к кандидату и о задачах.\n\nКоротко о себе:\nБолее восьми лет занимаюсь управлением проектами, анализом и операционкой в IT. Имею сильный технический бэкграунд: проектирую системы на уровне архитектуры и сам программирую. Хорошо понимаю весь жизненный цикл разработки софта по SDLC, в двух компаниях с нуля построил воркфлоу разработки и CI/CD. Обладаю значительным опытом работы анализа и формализации требований. Прошёл школу заказной и продуктовой разработки в крупных компаниях, умею вести переговоры с высокими ставками.\n\nБуду рад обсудить, как мой опыт может быть для вас полезен.\n\nС уважением,\Имя Фамилия\n+7 (000) 000-00-00 | Tg: @никнейм | почта@gmail.com",
  "telemetry_client_id": "_______",
  "token": {
    "access_expires_at": _______,
    "access_token": "_______",
    "refresh_token": "_______"
  }
}
```

**Важно:** Убедитесь, что после активации виртуальной среды (`source venv/bin/activate`) вы остаетесь в этой же сессии терминала для последующих шагов.

### Шаг 2: Установка `hh-apply-cli` и зависимостей

1. **Установите зависимости для интерактивного интерфейса:**

    ```bash
    # Для Debian/Ubuntu
    sudo apt update
    sudo apt install jq fzf w3m curl

    # Для macOS (с помощью Homebrew)
    brew install jq fzf w3m curl
    ```

2. **Создайте файл скрипта `hh-apply-cli`:**

    Рекомендуется размещать скрипт в директории, которая находится в вашем `$PATH`, чтобы вы могли вызывать его из любого места. Например, `/usr/local/bin/`.

    ```bash
    # Создаем файл
    sudo nano /usr/local/bin/hh-apply-cli
    ```

3. **Скопируйте код** скрипта `hh-apply-cli` и вставьте его в открывшийся редактор `nano`.
    -   Для вставки: `Ctrl + Shift + V` (в большинстве терминалов)
    -   Для сохранения: `Ctrl + O`, затем `Enter`
    -   Для выхода: `Ctrl + X`

4. **Сделайте скрипт исполняемым:**

    ```bash
    sudo chmod +x /usr/local/bin/hh-apply-cli
    ```

## Принцип работы

### Интерактивный визард

При каждом запуске скрипт проведет вас через несколько шагов:

1.  **Выбор резюме:** Если у вас несколько резюме, скрипт предложит выбрать одно для поиска и откликов. Если резюме одно, этот шаг будет пропущен.
2.  **Выбор режима:** Вы можете выбрать автоматический или ручной режим поиска.
3.  **Настройка фильтров (для автоматического режима):** Скрипт последовательно спросит про желаемый формат работы, город и зарплату. Эти фильтры будут применены к списку **рекомендованных** вакансий, полученных от hh.ru.

После прохождения визарда экран очистится, и начнется поиск вакансий с заданными параметрами.

### Настройки для ручного режима

Если вы выбрали "Ручной" режим, поиск будет производиться на основе переменных, заданных в верхней части файла скрипта.
- `WORK_FORMAT`: Формат работы (`REMOTE`, `ON_SITE` и т.д.).
- `AREA_ID`: ID города для поиска. Чтобы найти ID, используйте флаг `--find-city`:
  ```bash
  hh-apply-cli --find-city
  ```
  В открывшемся интерактивном поиске найдите нужный город, нажмите Enter, и скрипт выведет строку вида `1	Москва`. Первое число (`1`) — это и есть ID.
- `ROLE_IDS_CONFIG`: ID профессиональных ролей.
- `TEXT_INCLUDE` и `NEGATIVE`: Ключевые слова для фильтрации вакансий.

### Общие настройки

Эти переменные влияют на оба режима поиска:
- `COVER_FILE`: Путь к файлу с сопроводительным письмом. Может быть полезно, если вы используете разные аккаунты.
- `PERIOD`: Период поиска в сутках (влияет только на ручной режим).
- `SKIP_APPLIED`: Пропускает вакансии от компаний, в которые вы уже откликались.
- `DEDUPE`: Удаляет дубликаты вакансий по паре "Название + Компания" (когда работодатели спамят одной и той же вакансией в разных городах).

### Настройка таблицы

Чтобы таблица хорошо смотрелась на вашем экране, задайте ширину каждой колонки в символах в переменных `MAX_"колонка"`. Чтобы изменить пропорции окна предпросмотра вакансии по умолчанию, задайте значение переменной `PREVIEW_WIDTH_PERCENT` в процентах. Также в интерфейсе терминала ширину можно изменить мышью.

### Настройка цветов

Для каждого цвета есть комментарий. 
> Важно! Чтобы не напороться на капчу во время подгонки цветов, рекомендуется запускать скрипт не чаще двух раз в минуту.

## Продвинутое использование

### Кэширование для защиты от блокировок

1.  **Кэш описаний:** Скрипт загружает детали вакансии **только в момент ее выбора** в списке и сохраняет результат в кэш. Это имитирует поведение человека и защищает от блокировок. **Важно:** Не рекомендуется слишком быстро пролистывать список, так как это может привести к большому числу API-запросов.
2.  **Кэш справочников:** При первом запуске скрипт скачивает и сохраняет справочники API (города, форматы работы). Это значительно ускоряет все последующие запуски.
3.  **Расположение и очистка кэша:** Все файлы хранятся в `~/.cache/pm-search-cache/`. Для полной очистки кэша используйте флаг:
    ```bash
    hh-apply-cli --clear-cache
    ```

### Обработка ошибок API и ограничений платформы

Скрипт умеет обрабатывать ~~криворукость разработчиков~~ некоторые странности в ответах API hh.ru:

- **Пустое описание:** Выводится заглушка `[ Описание ... недоступно через API ]`.
- **"Битые" JSON:** Скрипт удалит поврежденный файл из кэша и предложит просмотреть вакансию еще раз.
- **Вакансии с вопросами:** Отклики на вакансии, требующие ответов на вопросы, будут автоматически пропущены, но появятся в итоговом CSV-отчете, чтобы вы могли откликнуться на них вручную.

## Оговорка

Вся работа с API делегирована утилите `hh-applicant-tool`. Если в ней произойдут критические изменения или она перестанет работать из-за изменений на стороне hh.ru, этот скрипт также перестанет работать.

## Лицензия

[MIT](https://choosealicense.com/licenses/mit/)

## Благодарности

- Огромная благодарность **Сергею ([s3rgeym](https://github.com/s3rgeym))** за создание и поддержку [hh-applicant-tool](https://github.com/s3rgeym/hh-applicant-tool).